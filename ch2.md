本章讨论信息在计算机上的表示方式。

* 2.1节介绍数字系统（Numeral Systems  ）和位置记数法（positional notation  ）的概念。
* 2.2节和2.3节分别讨论了数字和文本在计算机上的表示方式。
* 2.4节会介绍数据在内存中的组织方式。
* 2.5节讨论指令是如何编码的



# 2.1 数字系统与位置计数法

数字系统是用来表示数字的系统。数字系统定义了一组符号（symbol）和规则，用于表示一组给定的数字（例如自然数）。举个例子，“一元数字系统“是一个数字系统，其中的每个自然数都由对应数量的符号表示。在这个系统中，假设基本符号是★，自然数1、2和5将分别表示为★，★★和★★★★★。

十进制数字系统是人类中最为常见的、用于表示整数/非整数的数字系统。令：

*   $D_{10}$ 是十进制系统重的符号集合，例如 $D_{10}=\{ \text{“0”，“1”，“2”，“3”，“4”，“5”，“6”，“7”，“8”，“9”}\}$，且
*  $d^i$ 是十进制系统中某个数字上的某一位（译注：**后续称之为digit**，任何进制都可以使用digit一词，即表示某个进制下的数字的**符号序列**上的某一位），即 $d^i ∈ D_{10}$ 
*  $number_{10}$ 是十进制系统中表示的一个数字

如公式2.1所示，任意自然数能够在十进制系统中用有序的 $m$ 位digit序列来表示，其中上标表示digit的位置。可见最右边的digit的位置是0，最左边digit的位置是 $m-1$

$$
number_{10} = d^{m-1}d^{m-2}...d^1d^0 \tag{2.1}
$$

例如，数字一千九百六十九可以表示为1969，此时, $m=4, d^3=  \text{“1”}, d^2=\text{“9”},  d^1=\text{“6”}, d^0=\text{“9”}$ ，令：

*   $symbol\_value(d^i)$ 是digit $d^i$ 中符号的值，且
*   $symbol\_value(\text{“0”})=0, symbol\_value(\text{“1”})=1..., symbol\_value(\text{“9”})=9$

则十进制系统中一个m位的数字的值能够使用公式2.2计算

$$
value(number_{10})= \sum_{i=0}^{i=m-1}  \underbrace{symbol\_value(d^i) \times 10^i}_{\text{digit value}} \tag{2.2}
$$

观察每个 $d^i$  自身值对整个数字的值的作用，可知这和 $di$ 所用的符号及其自身的位置（ $i$ ）相关。例如数字1969有四个digit： $d^3=$ `1`, $d^2=$ `9`,  $d^1=$ `6`, $d^0=$  `9` ，其中 $d^2$ 的值是 900  而 $d^0$ 的值是 9 。

**位置数字系统（positional numeral system  ）是一种数字系统，其中一个digit $di$ 的值取决于 $di$ 的符号的值**，也取决于该 $di$ 在序列中的位置。十进制数字系统是一种位置数字系统。另一方面，一元和罗马数字系统是非位置数字系统的常见例子。

**数字系统的基，是指一个digit可以使用的不同符号的数量，digit使用不同的符号来表示不同的数字**。一元数字系统的基是1而十进制数字系统的基是10。

二进制、八进制、十进制、十六进制都是位置数字系统，它们在计算机编程中频繁使用。它们之间的唯一差异是基，十进制的基是10，而二进制、八进制和十六进制的基分别是2、8和16。

令：

*  $base$ 是位置数字系统的基
*  $D_{base}$ 位置数字系统中的符号的集合， 如 $D_2=\{\text{“0”, “1”}\}$  且
*  $d^i_{base}$ 是被位置数字系统表示的数字的第 $i$  个digit，即 $d^i_{base} ∈ D_{base}$
*  $number_{base}$ 是被数字系统表示的一个数字

> 译注：由于digit实在难以翻译，因此保留原文，以后凡是提到digit这个词的地方，都是指数字中的某一位

则任意自然数能够被二、八、十、十六进制的位置数字系统通过m位的digit序列表示出来，如公式2.3所示   

$$
number_{base} = d_{base}^{m-1}d_{base}^{m-2}...d_{base}^1d_{base}^0  \tag{2.3}
$$

令：

*  $symbol\_value(d_{base}^i)$ 是digit $d_{base}^i$ 中符号的值，且
*  $symbol\_value('0')=0, symbol\_value('1')=1$，以此类推

则在上述的位置数字系统中，一个含有m位digit的自然数的值可以用公式2.4来表示


$$
value(number_{base})= \sum_{i=0}^{i=m-1}  \underbrace{symbol\_value(d_{base}^i) \times base^i}_{\text{digit value}} \tag{2.4}
$$


例如，在二进制位置数字系统中（ $base =2$ ），任意自然数的值可以用公式2.5表示


$$
value(number_2)= \sum_{i=0}^{i=m-1}  \underbrace{symbol\_value(d_2^i) \times 2^i}_{\text{digit value}} \tag{2.5}
$$


注意，`11`在二进制系统中的值是3（ $1 \times 2^1 + 1 \times 2^ 0$ ），在十进制中是（ $1 \times 10^1 + 1 \times 10^ 0$ ），在十六进制系统中是17（ $1 \times 16^1 + 1 \times 16^ 0$ ）



当同时使用多个数字系统时，通常需要对数字进行标记，以便能够识别所使用的数字系统，并确定其值。一种常见的表示法是在数字后面添加一个下标，以表示位置数字系统的基。例如，数字 $11_{10}$ 的值是11，而数字 $11_2$的值是3。



然而在计算机程序，使用下标并不是一种自然的方法。常见的方法是使用后缀来表示数字的基。例如在C语言，程序员可能会使用前缀`0b/0/0x`来表明数字是二、八、十六进制的，此时的基分别是`2/8/16`。如果没有前缀的话，则默认为十进制。



二进制和八进制数字系统使用十进制数字系统中符号的子集来表示数字。另一方面，十六进制数字系统需要10个以上的符号，因此需要新的符号。在这种情况下，字母表的第一个字母用于补充符号集。表2.1给出了这些位置数字系统中使用的符号及其对应的值。



| 符号  | 符号的值（基于十进制） | 二进制中使用 | 八进制中使用 | 十进制中使用 | 十六进制中使用 |
| ----- | ---------------------- | ------------ | ------------ | ------------ | -------------- |
| "`0`" | 0                      | ✔️            | ✔️            | ✔️            | ✔️              |
| "`1`" | 1                      | ✔️            | ✔️            | ✔️            | ✔️              |
| "`2`" | 2                      |              | ✔️            | ✔️            | ✔️              |
| "`3`" | 3                      |              | ✔️            | ✔️            | ✔️              |
| "`4`" | 4                      |              | ✔️            | ✔️            | ✔️              |
| "`5`" | 5                      |              | ✔️            | ✔️            | ✔️              |
| "`6`" | 6                      |              | ✔️            | ✔️            | ✔️              |
| "`7`" | 7                      |              | ✔️            | ✔️            | ✔️              |
| "`8`" | 8                      |              |              | ✔️            | ✔️              |
| "`9`" | 9                      |              |              | ✔️            | ✔️              |
| "`A`" | 10                     |              |              |              | ✔️              |
| "`B`" | 11                     |              |              |              | ✔️              |
| "`C`" | 12                     |              |              |              | ✔️              |
| "`D`" | 13                     |              |              |              | ✔️              |
| "`E`" | 14                     |              |              |              | ✔️              |
| "`F`" | 15                     |              |              |              | ✔️              |
| "`G`" | 16                     |              |              |              | ✔️              |

> 表2.1：二、八、十、十六进制数字系统中使用的符号及其值



| 值（基于十进制） | 十六进制表示 | 十进制表示 | 八进制表示 | 二进制表示 |
| ---------------------- | ------------ | ---------- | ---------- | ---------- |
| 0                      | $0_{16}$     | $0_{10}$  | $0_{8}$ | $0_2$      |
| 1                      | $1_{16}$     | $1_{10}$  | $1_{8}$ | $1_2$      |
| 2                      | $2_{16}$     | $2_{10}$  | $2_{8}$ | $10_2$     |
| 3                      | $3_{16}$     | $3_{10}$  | $3_{8}$ | $11_2$     |
| 4                      | $4_{16}$     | $4_{10}$  | $4_{8}$ | $100_2$    |
| 5                      | $5_{16}$     | $5_{10}$  | $5_{8}$ | $101_2$    |
| 6                      | $6_{16}$     | $6_{10}$  | $6_{8}$ | $110_2$    |
| 7                      | $7_{16}$     | $7_{10}$  | $7_{8}$ | $111_2$    |
| 8                      | $8_{16}$     | $8_{10}$  | $10_{8}$ | $1000_2$  |
| 9                      | $9_{16}$     | $9_{10}$  | $11_{8}$ | $1001_2$  |
| 10                     | $A_{16}$     | $10_{10}$ | $12_{8}$ | $1010_2$  |
| 11                     | $B_{16}$     | $11_{10}$ | $13_{8}$ | $1011_2$  |
| 12                     | $C_{16}$     | $12_{10}$ | $14_{8}$ | $1100_2$  |
| 13                     | $D_{16}$     | $13_{10}$ | $15_{8}$ | $1101_2$  |
| 14                     | $E_{16}$     | $14_{10}$ | $16_{8}$ | $1110_2$  |
| 15                     | $F_{16}$     | $15_{10}$ | $17_{8}$ | $1111_2$  |
| 16                     | $10_{16}$    | $16_{10}$ | $20_{8}$ | $10000_2$ |
| 17                     | $11_{16}$    | $17_{10}$ | $21_{8}$ | $10001_2$ |
| 18                     | $12_{16}$    | $18_{10}$ | $22_{8}$ | $10010_2$ |
| 19                     | $13_{16}$    | $19_{10}$ | $23_{8}$ | $10011_2$ |
| 20                     | $14_{16}$    | $20_{10}$ | $24_{8}$ | $10100_2$ |

> 表2.2 ：值0~20在二、八、十、十六进制数字系统中的表示



## 2.1.1 在不同的进制之间对数字进行转换

在许多情况下，在不同的位置数字系统之间转换数字是一项常见的任务，特别是在编程或调试计算机系统时。由于人类通常更喜欢使用十进制数字系统进行思考，他们通常将其他位置数字系统的数字转换为十进制数字系统来推理它们的值。此外，在某些情况下，可能需要转换值为二进制、八进制或十六进制数字系统。

公式2.4展示了如何在任意位置数字系统上计算的数字的值

要在位置数字系统中表示值 $V$，必须找到如同公式2.4中的序列 $d_{base}^{m-1}d_{base}^{m-2}...d_{base}^1d_{base}^0$ ，这个序列的基是 $b$。 令 $v(d_b^i)$为序列中第 $i$个digit的值，则有公式



$$
V = v(d_b^{m-1}) \times b^{m-1} + ... + v(d_b^1) \times b^1+ v(d_b^0)\times b^0 \tag{2.6}
$$



化简一下：



$$
V = b \times \underbrace{(v(d_b^{m-1}) \times b^{m-2} + ... + v(d_b^1) \times b^0)}_{  V'} + v(d_b^0) \tag{2.6}
$$



留意到 $v(d_b^0)$和 $V'$ 就是 $V / b$ 的余数和商，所以，为了求digit  $d_b^0$ 的值，只需要求出 $V / b$ 的余数 。

根据这个原理，digit  $d_b^1$的值（ $v(d_b^0)$ ）就等于  $V' / b$的余数。

令 $symbol\_from\_value(v,b)$是一个函数，该函数返回了值 $v$在基 $b$上的符号（例如 $symbol\_from\_value(11,16)=\text{“}B\text{”}$），假设 $d_{base}^{m-1}d_{base}^{m-2}...d_{base}^1d_{base}^0$ 是值 $v$在基 $b$上表示，则算法 2展示了一种计算该序列的方法。

>  算法2：计算出值 $V$在基 $b$上的表示： $d_{base}^{m-1}d_{base}^{m-2}...d_{base}^1d_{base}^0$ 
>
> 输入：值 $V$，其基是 $b$
>
> 输出：序列 $d_{base}^{m-1}d_{base}^{m-2}...d_{base}^1d_{base}^0$ 

```bash
i=0;
temp = V
while tmp ≠ 0 do
    rem = tmp mod b
    db_i  = symbol_from_value(v,b) # 这里的db_i即上述序列中第i个digit
	tmp = tmp /b 
	i = i + 1
end    
```

为了解释算法2，让我们来计算值26在2进制下的序列 $d_2^{m-1}d_2^{m-2}...d_2^1d_2^0$。

* 首先，将26除以2，得到商13和余数0，所以 $v(d_2^0)=0，d_2^0=\text{“}0\text{”}$ ，过程如图2.1a所示
* 为了计算 $v(d_2^1)$，需要将13（上一步除法的商）除以2，得到商6和余数1。所以， $v(d_2^1)=1，d_2^1=\text{“}1\text{”}$ ，过程如图2.1b所示
* 为了计算 $v(d_2^2)$，需要将6（上一步除法的商）除以2，得到商3和余数0。所以， $v(d_2^2)=0，d_2^2=\text{“}0\text{”}$ ，过程如图2.1b所示
* 接着计算 $v(d_3^2)$，需要将3（上一步除法的商）除以2，得到商1和余数1。所以， $v(d_2^3)=1，d_2^3=\text{“}1\text{”}$ 
* 最后，需要将1（上一步除法的商）除以2，得到商0和余数1。所以， $v(d_2^4)=1，d_2^4=\text{“}1\text{”}$。此时商为0，算法终止。

此时，序列 $11010_2$就是值26在二进制数字系统上的表示。图2.1c展示了算法执行的全过程

![](./imgs/ch2/2.1.png)



![](./imgs/ch2/2.2.png)

将一个数字从基A的位置数字系统转换到基B的位置数字系统，我们可以使用公式2.4计算出数字在基A上的值，然后使用算法2计算出他在基B上的表示方式，即 $d_B^{m-1}d_B^{m-2}...d_B^1d_2^0$。



在16机制中表示数字要比2进制紧凑。例如，100的十六进制表示是 $3E8_{16}$，只需要3个digit，而二进制（ $1111101000_2$）需要10个digit。因为两者的基都是2的幂，这些基之间的转换可以通过用一个十六进制数字替换连续4位的子集来完成，反之亦然。例如，公式2.8展示了如何将数字 $3E8_{16}$转换为二进制，公式2.9展示了如何将数字 $1111101000_2$转换为十六进制。


$$
{\underbrace{3}_{0011_2}\underbrace{E}_{1110_2}\underbrace{8}_{1000_2}}_{16}= 001111101000_2 = 1111101000_2 \tag{2.8}
$$



$$
{\underbrace{10}_{2_{16}}\underbrace{1101}_{D_{16}}\underbrace{0111}_{7_{16}}\underbrace{0101}_{5_{16}}}_2= 2D75_{16} \tag{2.9}
$$




# 2.2 在计算机中表示数字

一个bianry digit，或者说bit，是二进制数字系统中的一个digit，它的值是0或1。大多数现代计算机都是用数字电路制造的。这些机器通常使用映射到两种状态的电压水平（voltage levels  ）来表示信息，这两种状态可以是HIGH/LOW，或者是0/1 。因此，现代计算机的基本信息单位是bit。因此，计算机上的数字是由bianry digit（或者说bit）的序列来表示。

## 2.2.1 无符号数

在计算机上，无符号数使用m位的二进制位置数字系统表示。换句话说，由二进制的digit序列 $d_2^{m-1}d_2^{m-2}...d_2^1d_2^0$表示，该数字的值由公式2.5定义。

无符号整数是自然数 $(\mathbb{N})  $的子集。自然数集中的数字有无穷多个(0到无穷大)，但在计算机上能表示的无符号数的集合取决于用于表示该数字的位数。例如，如果只使用8个比特位表示数字，那么只能表示256个数字。此时最小的数是0（ $00000000_2$），最大的数是255（ $11111111_2$）。计算机上可以使用m个bit来表示 $[0 . .(2^m−1)]$范围内的自然数。

通常，编译器将编程语言的（数据）类型映射为本机（原生）类型，即计算机体系结构已知的类型。例如，在32位计算机上，C语言中的`unsigned integer`类型被编译器映射为32位的*字*（word）。换句话说，在32位计算机上，无符号整数可以表示 $[0 . .(2^{32}−1)]$之间的数字。此时0表示为：


$$
000000000 000000000 000000000 000000000_2 \tag{2.10}
$$


而 $2^{32}−1$则表示为


$$
11111111 11111111 11111111 11111111_2 \tag{2.11}
$$


为说明这个概念，表2.3给出了可以用3位（bit）的*字*表示的无符号数的列表

| 3位（bit）的字 | 值       |
| -------------- | -------- |
| 000            | $0_{10}$ |
| 001            | $1_{10}$ |
| 010            | $2_{10}$ |
| 011            | $3_{10}$ |
| 100            | $4_{10}$ |
| 101            | $5_{10}$ |
| 110            | $6_{10}$ |
| 111            | $7_{10}$ |

> 表2.3

## 2.2.1 有符号数

在计算机中，有符号数是整数集 $(\mathbb{I})$ 的一个子集。有符号数集通常包含负数和非负数。尽管整数集是无限的，但计算机上可表示的带有符号数集取决于用于表示数字的位数以及有符号数的表示方式。最常用的有符号数表示法是“二进制补码”。接下来的几节将介绍这三种符号表示法：

* signal and magnitude （原码）
* one’s complement  （反码）
* two’s complement（二进制补码）





**Signal and magnitude（原码）**

“signal and magnitude”  是一种数字的表示方法，该方法用来在计算机上表示有符号数。在这种方法里面，有符号数用一个m位的序列来表示，其中 $d_2^{m-1}$ 表示符号，剩下的部分，即 $d_2^{m-2}$ 到 $d_2^0$ 表示大小，大小可以通过公式2.5来计算。在这种情况下，  $d_2^{m-1}$ 为1表示负数， $d_2^{m-1}$为0表示非负数。表2.4展示了3个bit的 *字* 分别在无符号和signal and magnitude表示法下的值

| 3个bit的*字* | 无符号下的值 | 原码下的值 |
| ------------ | ------------ | ---------- |
| 000          | $0_{10}$     | $0_{10}$   |
| 001          | $1_{10}$     | $1_{10}$   |
| 010          | $2_{10}$     | $2_{10}$   |
| 011          | $3_{10}$     | $3_{10}$   |
| 100          | $4_{10}$     | $-0_{10}$  |
| 101          | $5_{10}$     | $-1_{10}$  |
| 110          | $6_{10}$     | $-2_{10}$  |
| 111          | $7_{10}$     | $-3_{10}$  |

> 表2.4



原码表示法，能使用m位的序列表示值在 $[-(2^{m-1} - 1)..(2^{m-1} - 1)]$ 范围内数字。



**one’s complement  （反码）**

反码表示法是一种数字表示法，可以用来表示有符号数。在这种表示法中，有符号数表示为一个m位的序列，因此位 $d_2^{m−1}$表示数字的符号，如果 $d_2^{m−1}$ 为1表示负数，否则表示非负数。

用反码表示的非负数（即 $d_2^{m−1}=0$ 的数）的大小的计算方式，与计算无符号数的值的方式相同，即使用公式2.5。例如，3位bit的二进制数字010，在反码表示中是一个非负数，其大小为2，因为 $0 \times 2^2 + 1 \times 2^1 + 0 \times 2^0 = 2$。

用反码表示的负数（即 $d_2^{m−1}=1$ 的数）的大小的计算方式分为两步，首先翻转将数字的所有位都取反，然后使用公式2.5进行计算。例如，3位bit的二进制数字110在反码中是一个负数，它的大小是1（注意是大小（magnitude），不是值），因为将它取反后（001）的值是1 （ $0 \times 2^2 + 0 \times 2^1 + 1 \times 2^0 = 1$ ）

表2.5给出了宽度为3个bit的 *字* 在三种不同表示法下的值。与原码类似，在反码表示中，0有两种表示。

反码表示法，能使用m位的序列表示值在 $[-(2^{m-1} - 1)..(2^{m-1} - 1)]$ 范围内数字。

| 3个bit的*字* | 无符号下的值 | 原码下的值 | 反码下的值 | 补码下的值 |
| ------------ | ------------ | ---------- | ---------- | ---------- |
| 000          | $0_{10}$     | $0_{10}$   | $0_{10}$   | $0_{10}$   |
| 001          | $1_{10}$     | $1_{10}$   | $1_{10}$   | $1_{10}$   |
| 010          | $2_{10}$     | $2_{10}$   | $2_{10}$   | $2_{10}$   |
| 011          | $3_{10}$     | $3_{10}$   | $3_{10}$   | $3_{10}$   |
| 100          | $4_{10}$     | $-0_{10}$  | $-3_{10}$   | $4_{10}$   |
| 101          | $5_{10}$     | $-1_{10}$  | $-2_{10}$   | $-3_{10}$   |
| 110          | $6_{10}$     | $-2_{10}$  | $-1_{10}$   | $-2_{10}$   |
| 111          | $7_{10}$     | $-3_{10}$  | $-0_{10}$   | $-1_{10}$   |

> 表2.5

**two’s complement（二进制补码）**







## 2.2.1 二进制运算和溢出

## 2.2.1 整数溢出



# 2.3 文本的表示



# 2.4 在内存中组织数据

## 2.4.1 主存中的文本

## 2.4.2 主存中的数字

## 2.4.3 主存中的数组

## 2.4.4 主存中的结构体（struct）



# 2.5 对指令进行编码
