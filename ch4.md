汇编程序被编码为纯文本文件，包含以下4项主要元素：

* 注释（comments）：注释是文本格式的补充记录，通常用于记录代码信息，但是它们对代码生成没有影响，汇编器会丢弃它们
* 标签（Labels）：如第3.2.1节所讨论的，标签是表示程序位置的“标记”。它们通常由以冒号 + 标签名称组成，并且可以插入到汇编程序中以标记程序位置，以便它可以被汇编指令或其他汇编命令（如汇编命令）引用
* 汇编指令（instructions）：汇编指令被汇编器用来转换为机器指令。它们通常被编码为字符串，包含助记符和参数序列（称为操作数）。例如，`addi a0, a1, 1`字符串包含助记符`addi`和三个操作数：`a0`, `a1`和`1`
* 汇编命令（directives）：汇编命令是用于协调汇编过程的命令。它们由汇编器解释。例如，汇编命令`.word 10`指示汇编器将32位的值（10）添加到程序中。汇编命令通常被编码为以下格式的字符串：点（.）+ 汇编命令名称 + 参数值

如前所述，注释对汇编过程没有影响，汇编器会将其丢弃。这通常由预处理器执行，它会删除所有注释和额外的空格。一旦去掉注释和额外的空格，汇编程序就只包含三种元素：标签、汇编指令和汇编命令。假设`<label>`、`<instruction>`和`<directive>`分别表示有效的标签、汇编指令和汇编指令，则在删除汇编语言的注释和额外的空格后，可以使用以下正则表达式来总结汇编语言的语法。

```assembly
PROGRAM    -> LINES
LINES      -> LINE ['\n' LINES]
LINE       -> [<label>] [<instruction>] |
              [<label>] [<directive>]
```

上述规则的前两行表明汇编代码由一行或者多行组成，每行之间用换行符`\n`分割。而最后一条规则表明：

* 行的内容可以为空，因为`<label>`、`<instruction>`和`<directive>`都是可选的
* 行能只包含：单个标签、单个汇编指令、单个汇编命令
* 行能只包含：标签 + 汇编指令
* 行能只包含：标签 + 汇编命令

下面的RV32I汇编代码包含了合法的行：

```assembly
x:
sum: addi a0, a1, 1
     ret
.section .data
y:   .word 10
```

下面的RV32I汇编代码包含了非法的行：

```assembly
x: z:
addi a0, a1, 1 sum:
	li a0, 2 li a1, 1
.word 10 .word 20
	.word 10 y:
addi a0, a1, 1 .word 12
.sdfoiywer 1    
```

* 第一行包含两个标签
* 第二行的指令在标签后（注意，当两者位于同一行时，标签必须位于指令之前)
* 第三行包含两个指令
* 第四行包含两个汇编命令，但是每行只允许一个指令或汇编命令。
* 第五行的汇编命令在标签后，但是，当两者位于同一行时，标签必须位于汇编命令之前。
* 第六行包含一个指令和一个汇编命令
* 七行包含一个无效汇编命令



下面的RV32I汇编代码也是非法的，因为单个指令的所有元素（助记符、操作数）必须位于同一行。汇编命令也同样有这个要求。

```assembly
addi
a0, a1, 1
```

GNU汇编器实际上是一系列汇编器的集合。它支持几种ISA，包括RV32I。虽然每种GNU汇编器处理的汇编语言是不同的（这是因为每种汇编语言的指令都和各自的机器指令相似且相互之间不同），但它们中的大多数使用相同的语法表示注释、标签和汇编命令。在这个场景下，一旦你学习了一种汇编语言，则容易学会另外一种新的汇编语言。

本书专门讨论能被GNU汇编器支持的RV32I汇编语言。接下来的章节会讨论RV32I中的注释、标签、汇编指令、汇编命令。

 

# 4.1 注释

RV32I汇编程序可能包含单行或多行注释。在GNU汇编器上，单行注释由一个行注释符分隔，该字符与目标平台相关，即它依赖于某个ISA。RV32I GNU汇编器使用`#`作为行注释符。在同一行中，`#`之后的所有字符都被认为是注释的一部分，下面的汇编代码展示了行注释的示例。

```assembly
x: .word 10 # This is a comment
foo: # My special function
    addi a0, a1, 1 # Adds one to a1 and store on a0 #
# This is # another # comment ## #
```

因为汇编预处理器会抛弃注释，它相当于以下代码：

```assembly
x: .word 10
foo:
    addi a0, a1, 1
```

多行注释是内容占用多行的注释，在GNU 汇编器中用配对的`/* */`符来分割它们

```assembly
sum1:
/* This
is
a
multi-line
comment.
*/
	addi a0, a1, 1
	ret
```

它相当于以下代码

```assembly
sum1:
	addi a0, a1, 1
	ret
```





# 4.2 汇编指令（Assembly instructions）

汇编器将汇编指令转换成机器指令，它们通常编码为一个字符串，其中包含一个助记符和一系列参数，这些参数称为操作数。例如，汇编指令`add x10, x11, x12`以17字节（每个字符一个字节）编码为纯文本，被汇编器转换为相应的机器指令，这个机器指令用4字节编码后的值为0x00c58533。

# 4.3 立即数

# 4.4 符号名称

# 4.5 标签

# 4.6 地址计数器和汇编的过程

# 4.7 汇编命令（Assembly directives  ）